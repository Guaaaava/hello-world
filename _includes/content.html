{%- comment -%}
  Modify main content of page:
  - add section breaks
  - attach section properties
  - filter out blank sections
{%- endcomment -%}

{% assign content = include.content %}

{%- assign sections = content | split: "<!-- section break -->" -%}

<!--
{% for section in sections %}
  {% assign dark = section | regex_scan: "dark: (.*);" | default: "" %}
  {% assign background = section
    | regex_scan: "background: (.*);"
    | default: nil
  %}
  {% assign size = section | regex_scan: "size: (.*);" | default: "page" %}

  <section
    class="background"
    data-size="{{ size }}"
    {% if dark == "true" or dark == "false" %}
      data-dark="{{ dark }}"
    {% endif %}
    {% if background %}
      style="--image: url('{{ background | relative_url }}')"
    {% endif %}
  >
    {{ section }}
  </section>
{% endfor %}
-->

{%- for section in sections -%}

  {%- assign section = section | strip -%}
  {%- unless section == "" -%}

    {%- assign full = false -%}
    {%- if section contains "<!-- section full -->" -%}
      {%- assign full = true -%}
    {%- endif -%}

    {%- assign dark = false -%}
    {%- if section contains "<!-- section dark -->" -%}
      {%- assign dark = true -%}
    {%- endif -%}

    {%- assign background = false -%}
    {%- if section contains "<!-- section background" and section contains "-->" -%}
      {%- assign background = section | split: "<!-- section background" | last | split: "-->" | first | strip_newlines | strip -%}
    {%- endif -%}

    <section
      class="background"
      {% if dark %}data-dark="true"{% endif %}
      {% if background %}style="--background: url('{{ background | relative_url }}')"{% endif %}
    >
      {%- if full == false -%}
      <div class="section">
      {%- endif -%}
        {{ section }}
      {%- if full == false -%}
      </div>
      {%- endif -%}
    </section>

  {%- endunless -%}

{%- endfor -%}